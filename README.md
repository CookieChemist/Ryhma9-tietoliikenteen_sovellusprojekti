# Tietoliikenteen sovellusprojekti



## Project overview

Developed as a part of a networking application course at OAMK. The goal of the project was to develop a system to measure and transmit accelerometer data, which would then be used to calculate cluster centers using k-means. The data was first measured using a Nordic Semiconductor nRF 5340DK development board and transmitted through Bluetooth Low Energy to a Raspberry Pi functioning as an IoT-router. Data was then uploaded into a MySQL database running on a separate Linux server, where it can be accessed for use in the k-means program. K-means was used to calculate six center points, which are used by a program running on the Nordic board to estimate sensor orientation.

<br>

Overview of system architecture pictured below:

![Pic missing](documents/TLProjectSystemArchitechture.JPG?raw=true "System architecture")

## A short description of the different programs in the system

### Nordic application for measuring sensor data and transmitting via BLE

Measures and transmits sensor data via BLE from the nRF530DK board to the Raspberry Pi. The program creates a custom service and characteristic with notification support. By subscribing to these notifications a client receives 3D coordinate values, one value per notification. Based on examples included in the Bluetooth Low Energy fundamentals course by Nordic Developer Academy.


### Python program for receiving and recording the BLE transmission

Using the [Bleak](https://github.com/hbldh/bleak) library, establishes a BLE connection to the development board with either its address or its device name. Subscribes to notifications from the custom characteristic and records the received data. A separate program is used to upload the data into a MySQL database hosted on a dedicated Ubuntu server.

### Python program for fetching data from database and formatting into .csv

Establishes a connection to the MySQL database using the [mysql-connector](https://github.com/mysql/mysql-connector-python) library and requests the measurement data. Writes the measurement data into a .CSV file for use in the K-means.

### Python K-means algorithm
Receives the .CSV file of measurement data containing sensor values, which will be used as coordinates for points in a 3D space. Randomly generates starting centers and assigns points to them based on distance. Afterwards assigns new centers based on the mean of all points assigned to the center in the previous step. If a center has no points assigned, it is generated again.

The cycle is repeated a set number of times and the final results are plotted in 3D chart like the one pictured below. Red dots are the points in the measurement data and the large triangles visible inside the clusters mark the final centers. 

![Pic missing](documents/kmeansplotted.png?raw=true "Kmeans plot")

### Nordic application for estimating sensor orientation and producing a confusion matrix.
Measures the current coordinates from the sensor and estimates the sensor orientation by comparing the values to the center points calculated with K-means. Generates a confusion matrix by comparing the estimated orientation to the actual orientation of the sensor that is assigned manually using the buttons on the board. Prints the confusion matrix to visualize and test the accuracy of the estimated sensor orientation and the centers calculated with K-means. 

Below is a confusion matrix generated by taking 100 measurements in the 6 different extremes.

![Pic missing](documents/confusionmatrix.png?raw=true "confusion matrix")


### Linux server and database

The MySQL database used throughout the project was hosted on a server running Ubuntu. As a part of the project the server was set up with custom firewall rules and an Apache server that was used for troubleshooting purposes when developing the programs that interacted with the database. Public key authentication was used for easy and secure SSH connections and Tailscale for use outside of the local network the server was in.




## List of technologies/tools utilized

- Python
- C 
- MySQL 
- Linux (Ubuntu and Raspberry OS)
- Nordic developer tools like nRF Connect
- nRF5340DK development kit

## License

This project uses the MIT license. 





